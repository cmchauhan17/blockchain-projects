<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="newUI.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>

    <title>Commitment</title>
</head>
<body>
    <div class="container-fluid px-1 py-5 mx-auto">
        <div class="row d-flex justify-content-center">
            <div class="col-xl-7 col-lg-8 col-md-9 col-11 text-center">
                <div class="card">
                    <h5 class="text-center mb-4">Enter Commitment</h5>
                    <form class="form-card" onsubmit="event.preventDefault()">
                            <div class="form-group col-sm-6 flex-column d-flex"> 
                                <label class="form-control-label px-3">Enter Commitment<span class="text-danger"> *</span></label> 
                                <input type="text" id="entercommitment" name="entercommitment" placeholder="Enter your Message" onblur="validate(2)">

                                <label class="form-control-label px-3">Enter Date<span class="text-danger"> *</span></label> 
                                <input type="text" id="enterdate" name="enterdate" placeholder="Enter today's Date" onblur="validate(2)">
                            </div>
                        <div class="row justify-content-end">
                            <div class="form-group col-sm-6"> <button type="submit" id="submitCommitment" class="btn-block btn-primary">Submit</button> </div>
                        </div>
                    </form>
                    <hr>
                    <div class="form-group col-sm-6"> <button type="submit" id="getContractAddress" class="btn-block btn-primary">Get Address</button> </div>
                    <p id="contractaddress"></p>
                </div>
        </div>
    </div>

	<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>

    <script>
        var contract;
        var WEB3;
    
    $(document).ready(function(){
    
        WEB3 = new Web3(web3.currentProvider);
    
            var address = "0x41CB9fda4aF9eA6206c03509701d4a2897d34481"
    
            var abi = [
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "storedData",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_commitment",
				"type": "string"
			},
			{
				"name": "_dateofCommitment",
				"type": "string"
			}
		],
		"name": "addData",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getAddressOfInputData",
		"outputs": [
			{
				"name": "",
				"type": "address[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "contractAddress",
				"type": "address"
			}
		],
		"name": "ContractCreated",
		"type": "event"
	}
];
    
            contract = new WEB3.eth.Contract(abi, address);

        //Submit Commitment
        $('#submitCommitment').click(function(){

            var entercommitment = document.getElementById("entercommitment").value;
            var enterdate = document.getElementById("enterdate").value;
    
            WEB3.eth.getAccounts().then(function(accounts){
                var acc = accounts[0];
                return contract.methods.addData(entercommitment, enterdate).send({from: acc});
            }).then(function(tx){
                console.log(tx);
            }).catch(function(tx){
                console.log(tx);
            })
        })

        //Get Address
        $('#getContractAddress').click(function(){
            contract.methods.getAddressOfInputData().call().then(function(contractAddress){
            $('#contractaddress').html(contractAddress);
            })
        })
    })
    </script>
    
</body>
</html>